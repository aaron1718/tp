DELIMITER $$
CREATE PROCEDURE rendicionDeHoras(in legajo int, in proyecto int, in anioMesDia date, in horas int)
begin
select a.horas_max_diarias into @max from empleados a where legajo = id_empleado;
if horas <= @max then
begin
    insert into asignacion (empleado_id, proyecto_id, asi_fecha, asi_cant_horas)
    values(legajo, proyecto, anioMesDia, horas);
end;
end if;
end
$$
DELIMITER $$
CREATE PROCEDURE calcularLiquidacionMensual(in id_cliente int, in periodo_mes int)
begin

begin
select sum(a.asi_cant_horas) into @horasuno from asignacion a where 1=proyecto_id and month(asi_fecha)=periodo_mes;
select sum(a.asi_cant_horas) into @horasdos from asignacion a where 2=proyecto_id and month(asi_fecha)=periodo_mes;
select sum(a.asi_cant_horas) into @horastres from asignacion a where 3=proyecto_id and month(asi_fecha)=periodo_mes;
select sum(a.asi_cant_horas) into @horascuatro from asignacion a where 4=proyecto_id and month(asi_fecha)=periodo_mes;

select c.precio_hora into @precio1 from cliente_proyecto c where id_proyecto=1;
select c.precio_hora into @precio2 from cliente_proyecto c where id_proyecto=2;
select c.precio_hora into @precio3 from cliente_proyecto c where id_proyecto=3;
select c.precio_hora into @precio4 from cliente_proyecto c where id_proyecto=4;


insert into liquidacion (cliente,horas,periodo,total) values 
(1,@horasuno,periodo_mes,truncate(@horasuno*@precio1,2)),
(2,@horasdos,periodo_mes,truncate(@horasdos*@precio2,2)),
(3,@horastres,periodo_mes,truncate(@horastres*@precio3,2)),
(4,@horascuatro,periodo_mes,truncate(@horascuatro*@precio4,2));


end
end
$$
